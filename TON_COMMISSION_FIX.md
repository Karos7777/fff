# ‚úÖ TON –ö–û–ú–ò–°–°–ò–Ø ‚Äî –ò–°–ü–†–ê–í–õ–ï–ù–û!

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

**–û–ø–ª–∞—Ç–∞ –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞–ª–∞—Å—å** –∏–∑-–∑–∞ –∫–æ–º–∏—Å—Å–∏–∏ TON!

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:
```
–û–∂–∏–¥–∞–ª–æ—Å—å: 1,000,000 nanoTON
–ü–æ–ª—É—á–µ–Ω–æ:    950,000 nanoTON (–∫–æ–º–∏—Å—Å–∏—è ~5%)
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```

### –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞:
```js
// –ò—Å–∫–∞–ª–∏ –¢–û–ß–ù–û–ï —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ¬±10%
Math.abs(received - expected) <= expected * 0.1
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –∫–æ–º–∏—Å—Å–∏—è > 10%, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª–∞—Å—å!

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞: >= 95%
```js
const expectedNano = 1_000_000;
const minAcceptable = expectedNano * 0.95; // 950,000 nanoTON

// –ò—â–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å —Å—É–º–º–æ–π >= 95%
const tx = data.result.find(t =>
  parseInt(t.in_msg.value) >= minAcceptable
);
```

**–¢–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ–º –ª—é–±—É—é —Å—É–º–º—É >= 95% –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–π!**

---

## üìã –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ server.js

### –ë—ã–ª–æ:
```js
const tx = data.result.find(t =>
  Math.abs(parseInt(t.in_msg.value) - expectedNano) <= expectedNano * 0.1
);
```

### –°—Ç–∞–ª–æ:
```js
const expectedNano = Math.round(parseFloat(inv.amount) * 1_000_000_000);
const minAcceptable = Math.round(expectedNano * 0.95); // ‚úÖ –ú–∏–Ω–∏–º—É–º 95%

const tx = data.result.find(t =>
  t.in_msg && 
  t.in_msg.source !== '' && 
  t.in_msg.destination === address &&
  parseInt(t.in_msg.value) >= minAcceptable // ‚úÖ >= –≤–º–µ—Å—Ç–æ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
);
```

---

## üöÄ –î–µ–ø–ª–æ–π

```bash
git add .
git commit -m "Fix TON polling: accept payments >= 95% to account for fees"
git push
```

---

## üìä –õ–æ–≥–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã:

```
[TON POLLING] –ü—Ä–æ–≤–µ—Ä–∫–∞ 1 –æ–∂–∏–¥–∞—é—â–∏—Ö –∏–Ω–≤–æ–π—Å–æ–≤...
[TON POLLING] ‚úÖ –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê! {
  orderId: 107,
  invoiceId: 145,
  txHash: "abc123...",
  receivedNano: 950000,
  expectedNano: 1000000,
  difference: "-5.00%",
  minAcceptable: 950000
}
```

**–í–∏–¥–Ω–æ:**
- –û–∂–∏–¥–∞–ª–æ—Å—å: 1,000,000 nanoTON
- –ü–æ–ª—É—á–µ–Ω–æ: 950,000 nanoTON
- –†–∞–∑–Ω–∏—Ü–∞: -5% (–∫–æ–º–∏—Å—Å–∏—è)
- –ú–∏–Ω–∏–º—É–º: 950,000 nanoTON
- –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ó–∞—Å—á–∏—Ç–∞–Ω–æ!

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–π –∑–∞–∫–∞–∑ –Ω–∞ 0.001 TON
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: 1,000,000 nanoTON
–ú–∏–Ω–∏–º—É–º:     950,000 nanoTON
```

### 2. –û–ø–ª–∞—Ç–∏ –≤ TON –∫–æ—à–µ–ª—å–∫–µ
```
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 0.001 TON
–ö–æ–º–∏—Å—Å–∏—è:   ~0.00005 TON
–ü–æ–ª—É—á–µ–Ω–æ:   ~0.00095 TON (950,000 nanoTON)
```

### 3. –ñ–¥–∏ polling (20 —Å–µ–∫)
```
[TON POLLING] ‚úÖ –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê!
```

### 4. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å
```
–ó–∞–∫–∞–∑ #107: paid ‚úÖ
–ò–Ω–≤–æ–π—Å #145: paid ‚úÖ
```

---

## üìà –ü—Ä–∏–º–µ—Ä—ã

| –û–∂–∏–¥–∞–ª–æ—Å—å | –ö–æ–º–∏—Å—Å–∏—è | –ü–æ–ª—É—á–µ–Ω–æ | –ú–∏–Ω–∏–º—É–º | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-----------|----------|----------|---------|-----------|
| 1,000,000 | 5% | 950,000 | 950,000 | ‚úÖ –ó–∞—Å—á–∏—Ç–∞–Ω–æ |
| 1,000,000 | 10% | 900,000 | 950,000 | ‚ùå –ù–µ –∑–∞—Å—á–∏—Ç–∞–Ω–æ |
| 50,000,000 | 3% | 48,500,000 | 47,500,000 | ‚úÖ –ó–∞—Å—á–∏—Ç–∞–Ω–æ |
| 100,000 | 6% | 94,000 | 95,000 | ‚ùå –ù–µ –∑–∞—Å—á–∏—Ç–∞–Ω–æ |

**–î–æ–ø—É—Å–∫: 5%** (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –∫–æ–¥–µ)

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ø—É—Å–∫–∞

### –ò–∑–º–µ–Ω–∏—Ç—å –¥–æ–ø—É—Å–∫ –∫–æ–º–∏—Å—Å–∏–∏:

```js
// –¢–µ–∫—É—â–∏–π: 95% (–¥–æ–ø—É—Å–∫ 5%)
const minAcceptable = Math.round(expectedNano * 0.95);

// –î–ª—è 90% (–¥–æ–ø—É—Å–∫ 10%):
const minAcceptable = Math.round(expectedNano * 0.90);

// –î–ª—è 98% (–¥–æ–ø—É—Å–∫ 2%):
const minAcceptable = Math.round(expectedNano * 0.98);
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 95%** (–¥–æ–ø—É—Å–∫ 5%)

---

## üéâ –ò–¢–û–ì

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è TON
- ‚úÖ –ü—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –ø–ª–∞—Ç–µ–∂–∏ >= 95%
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã

**–¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –û–ø–ª–∞—Ç–∞ 0.001 TON ‚Üí –ó–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ –ö–æ–º–∏—Å—Å–∏—è –¥–æ 5% ‚Üí –û–∫
- ‚úÖ Polling –Ω–∞—Ö–æ–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–û–ü–õ–ê–¢–ê –†–ê–ë–û–¢–ê–ï–¢!** üöÄüíé

---

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –≤—Å—ë –µ—â—ë –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ polling**
   ```bash
   railway logs --follow | grep "TON POLLING"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å —Å—É–º–º—É –≤ –±–ª–æ–∫—á–µ–π–Ω–µ**
   ```
   https://tonscan.org/address/<YOUR_ADDRESS>
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É**
   ```js
   console.log('Expected:', expectedNano);
   console.log('Min acceptable:', minAcceptable);
   console.log('Received:', received);
   ```

4. **–£–≤–µ–ª–∏—á—å –¥–æ–ø—É—Å–∫ –¥–æ 10%**
   ```js
   const minAcceptable = Math.round(expectedNano * 0.90);
   ```

**–ì–û–¢–û–í–û!** üéØ
