<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - –ú–∞–≥–∞–∑–∏–Ω</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>–ú–∞–≥–∞–∑–∏–Ω (Debug Mode)</h1>
        </header>

        <div class="debug-info">
            <h3>–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π:</h3>
            <div id="moduleStatus"></div>
        </div>

        <div class="user-info" id="userInfo" style="display: none;">
            <span id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
            <button id="logoutBtn" class="btn-secondary">–í—ã—Ö–æ–¥</button>
        </div>

        <div class="auth-section" id="authSection">
            <div class="auth-card">
                <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                <p>–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∞–≥–∞–∑–∏–Ω—É</p>
                <button id="authBtn" class="btn-primary">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</button>
            </div>
        </div>

        <main class="main-content" id="mainContent" style="display: none;">
            <div class="products-section">
                <h2>–¢–æ–≤–∞—Ä—ã</h2>
                <div id="productsGrid" class="products-grid">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
                </div>
            </div>
        </main>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
    </div>

    <script>
        const moduleStatus = document.getElementById('moduleStatus');
        
        function logStatus(message) {
            console.log(message);
            moduleStatus.innerHTML += '<p>' + message + '</p>';
        }
        
        logStatus('üöÄ –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏...');
        
        // –ü—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function showAuthSection() {
            document.getElementById('authSection').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
        }
        
        function showMainContent() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('userInfo').style.display = 'flex';
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        // –ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        async function testAuth() {
            try {
                showLoading();
                logStatus('üîê –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
                
                // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                const testUser = {
                    telegram_id: 123456789,
                    username: 'testuser',
                    first_name: 'Test',
                    last_name: 'User'
                };
                
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testUser)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    logStatus('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                    localStorage.setItem('authToken', data.token);
                    showMainContent();
                    await loadProducts();
                } else {
                    const error = await response.text();
                    logStatus('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + error);
                }
            } catch (error) {
                logStatus('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            } finally {
                hideLoading();
            }
        }
        
        // –ü—Ä–æ—Å—Ç–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
        async function loadProducts() {
            try {
                logStatus('üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...');
                
                const response = await fetch('/api/products');
                
                if (response.ok) {
                    const products = await response.json();
                    logStatus('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ' + products.length);
                    
                    const grid = document.getElementById('productsGrid');
                    if (products.length === 0) {
                        grid.innerHTML = '<p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                    } else {
                        grid.innerHTML = products.map(product => `
                            <div class="product-card">
                                <h3>${product.name}</h3>
                                <p>${product.description || ''}</p>
                                <div class="product-price">${product.price} $</div>
                            </div>
                        `).join('');
                    }
                } else {
                    const error = await response.text();
                    logStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤: ' + error);
                }
            } catch (error) {
                logStatus('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            logStatus('üì± DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram WebApp
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                logStatus('‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } else {
                logStatus('‚ö†Ô∏è Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('authBtn').addEventListener('click', testAuth);
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('authToken');
                showAuthSection();
                logStatus('üö™ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
            const token = localStorage.getItem('authToken');
            if (token) {
                logStatus('üîë –ù–∞–π–¥–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω');
                showMainContent();
                loadProducts();
            } else {
                logStatus('üîê –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é');
                showAuthSection();
            }
            
            logStatus('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        });
    </script>
</body>
</html>
