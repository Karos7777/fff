<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –û—Ç–ª–∞–¥–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        
        /* –ü—Ä–æ—Å—Ç—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            position: relative;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: black;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –û—Ç–ª–∞–¥–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π</h1>
        
        <div class="status info">
            <strong>–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏:</strong>
            <div id="loadStatus">–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã...</div>
        </div>
        
        <button class="btn" onclick="testModal()">–¢–µ—Å—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞</button>
        <button class="btn" onclick="testPaymentManager()">–¢–µ—Å—Ç PaymentManager</button>
        <button class="btn" onclick="testOrder()">–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞</button>
        <button class="btn" onclick="forceCloseModal()">–ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞</button>
        <button class="btn" onclick="testPaymentOptions()">–¢–µ—Å—Ç –æ–ø—Ü–∏–π –æ–ø–ª–∞—Ç—ã</button>
        
        <div id="testResults"></div>
    </div>

    <!-- –ü—Ä–æ—Å—Ç–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ -->
    <div id="testModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTestModal()">&times;</span>
            <h2>–¢–µ—Å—Ç–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ</h2>
            <p>–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ, –∑–Ω–∞—á–∏—Ç –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Ä–∞–±–æ—Ç–∞—é—Ç!</p>
            <button class="btn" onclick="closeTestModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        const testToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidGVsZWdyYW1faWQiOiIxMjM0NTY3ODkiLCJ1c2VybmFtZSI6InRlc3R1c2VyIiwicm9sZSI6InVzZXIiLCJpc19hZG1pbiI6MCwiaWF0IjoxNzYyMDUyNTQ3LCJleHAiOjE3NjIxMzg5NDd9.85OUzR36U5pSat6JOZ39LTwxEYR8ZNlCowQ63lJr0Xs';
        localStorage.setItem('token', testToken);

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('loadStatus');
            statusDiv.innerHTML = message;
            statusDiv.className = type;
        }

        function testModal() {
            console.log('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
            document.getElementById('testModal').style.display = 'block';
        }

        function closeTestModal() {
            document.getElementById('testModal').style.display = 'none';
        }

        function testPaymentManager() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º PaymentManager...</div>';
            
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ PaymentManager');
            console.log('window.PaymentManager:', window.PaymentManager);
            console.log('window.paymentManager:', window.paymentManager);
            
            if (window.paymentManager) {
                resultsDiv.innerHTML = '<div class="status success">‚úÖ PaymentManager –Ω–∞–π–¥–µ–Ω!</div>';
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                try {
                    window.paymentManager.showModal('<h3>–¢–µ—Å—Ç PaymentManager</h3><p>–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!</p>');
                    resultsDiv.innerHTML += '<div class="status success">‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ PaymentManager —Ä–∞–±–æ—Ç–∞–µ—Ç!</div>';
                } catch (error) {
                    resultsDiv.innerHTML += `<div class="status error">‚ùå –û—à–∏–±–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: ${error.message}</div>`;
                    console.error('–û—à–∏–±–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', error);
                }
            } else {
                resultsDiv.innerHTML = '<div class="status error">‚ùå PaymentManager –Ω–µ –Ω–∞–π–¥–µ–Ω!</div>';
            }
        }

        async function testOrder() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="status info">–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞...</div>';
            
            try {
                const response = await fetch('/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${testToken}`
                    },
                    body: JSON.stringify({
                        product_id: 14
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultsDiv.innerHTML = `<div class="status success">‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω! ID: ${data.id}</div>`;
                } else {
                    resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${data.error}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
                console.error('–û—à–∏–±–∫–∞ –∑–∞–∫–∞–∑–∞:', error);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => {
                let status = [];
                
                if (window.PaymentManager) {
                    status.push('‚úÖ PaymentManager –∫–ª–∞—Å—Å –Ω–∞–π–¥–µ–Ω');
                } else {
                    status.push('‚ùå PaymentManager –∫–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                if (window.paymentManager) {
                    status.push('‚úÖ paymentManager —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞–π–¥–µ–Ω');
                } else {
                    status.push('‚ùå paymentManager —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                updateStatus(status.join('<br>'));
            }, 1000);
        });

        function forceCloseModal() {
            console.log('üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω');
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const testModal = document.getElementById('testModal');
            if (testModal) {
                testModal.style.display = 'none';
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ PaymentManager
            if (window.paymentManager) {
                window.paymentManager.closeModal();
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
            document.body.style.overflow = 'auto';
            
            // –ò—â–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∏—Ö
            const allModals = document.querySelectorAll('.modal, #paymentModal');
            allModals.forEach(modal => {
                modal.style.display = 'none';
            });
            
            console.log('‚úÖ –í—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∑–∞–∫—Ä—ã—Ç—ã');
        }

        function testPaymentOptions() {
            console.log('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º showPaymentOptions');
            
            if (window.paymentManager) {
                try {
                    window.paymentManager.showPaymentOptions(
                        123, // orderId
                        14,  // productId
                        '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä',
                        100  // price
                    );
                    console.log('‚úÖ showPaymentOptions –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                    
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 500ms
                    setTimeout(() => {
                        const modal = document.getElementById('paymentModal');
                        if (modal) {
                            console.log('üîç –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:');
                            console.log('- style.display:', modal.style.display);
                            console.log('- classList:', modal.classList.toString());
                            console.log('- offsetHeight:', modal.offsetHeight);
                            console.log('- offsetWidth:', modal.offsetWidth);
                            
                            // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –≤–∏–¥–Ω–æ - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
                            if (modal.offsetHeight === 0) {
                                console.log('üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏');
                                modal.style.cssText = 'display: block !important; position: fixed !important; z-index: 99999 !important; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8);';
                            }
                        }
                    }, 500);
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –≤ showPaymentOptions:', error);
                }
            } else {
                console.error('‚ùå PaymentManager –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('testModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º PaymentManager -->
    <script src="payment.js"></script>
</body>
</html>
