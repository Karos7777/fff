# ‚úÖ TON CHECK ENDPOINT ‚Äî –ò–°–ü–†–ê–í–õ–ï–ù–û!

## üéØ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞
–§—Ä–æ–Ω—Ç –ø–æ–ª—É—á–∞–ª –æ—à–∏–±–∫—É –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ–ø–ª–∞—Ç—ã: "–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã"

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω **GET endpoint** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞.

---

## üìã –ù–æ–≤—ã–π endpoint

### GET `/api/ton/check/:orderId`

**–ó–∞–ø—Ä–æ—Å:**
```http
GET /api/ton/check/105
Authorization: Bearer <JWT_TOKEN>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "paid": true,
  "invoice_status": "paid",
  "order_status": "paid"
}
```

–∏–ª–∏

```json
{
  "paid": false,
  "invoice_status": "pending",
  "order_status": "pending"
}
```

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É"

### 2. –§—Ä–æ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç GET –∑–∞–ø—Ä–æ—Å
```js
const response = await fetch(`/api/ton/check/${orderId}`, {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

### 3. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î
```sql
SELECT i.status as invoice_status, o.status as order_status 
FROM invoices i 
JOIN orders o ON i.order_id = o.id 
WHERE o.id = 105 AND o.user_id = 1
```

### 4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `paid: true` ‚Üí –û–ø–ª–∞—á–µ–Ω–æ ‚úÖ
- `paid: false` ‚Üí –ï—â—ë –Ω–µ –æ–ø–ª–∞—á–µ–Ω–æ ‚è≥

---

## üöÄ –î–µ–ø–ª–æ–π

```bash
git add .
git commit -m "Add GET endpoint for TON payment status check"
git push
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–π –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ TON
- Mini App ‚Üí –¢–æ–≤–∞—Ä ‚Üí "–ö—É–ø–∏—Ç—å" ‚Üí "TON"
- –ü–æ–ª—É—á–∏ QR-–∫–æ–¥

### 2. –ù–∞–∂–º–∏ "üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É"
- –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: "–û–ø–ª–∞—Ç–∞ –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. Polling –ø—Ä–æ–≤–µ—Ä–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 20 —Å–µ–∫."

### 3. –û–ø–ª–∞—Ç–∏ –≤ TON –∫–æ—à–µ–ª—å–∫–µ

### 4. –ü–æ–¥–æ–∂–¥–∏ 20 —Å–µ–∫—É–Ω–¥ (polling)
- –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 5. –ù–∞–∂–º–∏ "üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É" —Å–Ω–æ–≤–∞
- –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: "‚úÖ –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞! –§–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è"

---

## üìä –õ–æ–≥–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:

```
[TON CHECK GET] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞: { orderId: 105, userId: 1 }
[TON CHECK GET] –°—Ç–∞—Ç—É—Å: { orderId: 105, isPaid: false, invoice_status: 'pending', order_status: 'pending' }
```

–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã:

```
[TON POLLING] ‚úÖ –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê! { orderId: 105, txHash: "..." }
[TON CHECK GET] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞: { orderId: 105, userId: 1 }
[TON CHECK GET] –°—Ç–∞—Ç—É—Å: { orderId: 105, isPaid: true, invoice_status: 'paid', order_status: 'paid' }
```

---

## üéØ Endpoints Summary

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/api/ton/check/:orderId` | GET | –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞) |
| `/api/ton/check-payment` | POST | –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ TON API (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π) |
| `/api/orders/:orderId/download` | GET | –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ |

---

## üéâ –ò–¢–û–ì

**–¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É"
- ‚úÖ GET endpoint `/api/ton/check/:orderId`
- ‚úÖ Polling –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:**
1. –û–ø–ª–∞—Ç–∏—Ç—å
2. –ù–∞–∂–∞—Ç—å "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É" (–∏–ª–∏ –ø–æ–¥–æ–∂–¥–∞—Ç—å 20 —Å–µ–∫)
3. –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª

**–ì–û–¢–û–í–û!** üöÄüíé
