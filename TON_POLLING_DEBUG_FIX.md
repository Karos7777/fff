# ‚úÖ TON POLLING DEBUG FIX ‚Äî –ì–û–¢–û–í–û!

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

```
[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #129: –æ–∂–∏–¥–∞–µ—Ç—Å—è 0.001 TON (–º–∏–Ω: 0.000900 TON)
   ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- Polling –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞–ª –¥–µ—Ç–∞–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–∞ –±—ã–ª–∞ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–æ–π (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è payload (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```js
// –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
data.result.forEach((t, idx) => {
  if (t.in_msg && t.in_msg.value && parseInt(t.in_msg.value) > 0) {
    const amount = parseInt(t.in_msg.value) / 1e9;
    const dest = t.in_msg.destination || 'unknown';
    const msg = t.in_msg.message || '';
    console.log(`[TON POLLING] TX ${idx + 1}: ${amount.toFixed(9)} TON ‚Üí ${dest.slice(0, 20)}... | msg: "${msg}"`);
  }
});
```

### 2. –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–ë–´–õ–û:**
```js
const tx = data.result.find(t =>
  t.in_msg?.destination === address &&  // ‚Üê –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
  parseInt(t.in_msg?.value || 0) / 1e9 >= min
);
```

**–°–¢–ê–õ–û:**
```js
const tx = data.result.find(t => {
  const txAmount = parseInt(t.in_msg.value) / 1e9;
  const txMessage = t.in_msg.message || '';
  const txDest = t.in_msg.destination || '';
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º: —Å—É–º–º–∞ >= min –ò (–∞–¥—Ä–µ—Å —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ò–õ–ò payload —Å–æ–≤–ø–∞–¥–∞–µ—Ç)
  const amountMatch = txAmount >= min;
  const addressMatch = txDest.includes(address.slice(0, 20)) || address.includes(txDest.slice(0, 20));
  const payloadMatch = txMessage === payload;
  
  return amountMatch && (addressMatch || payloadMatch);
});
```

**–£–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ payload (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è) `order_129`
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ (–ø–µ—Ä–≤—ã–µ 20 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
git add .
git commit -m "Fix: improve TON polling with detailed logging and payload check"
git push
```

**–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**

### 1. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
```bash
curl -X POST http://localhost:8080/api/orders \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"product_id": 8, "payment_method": "ton"}'
```

### 2. –û–ø–ª–∞—Ç–∏ —Å–æ —Å–≤–æ–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
**–í–ê–ñ–ù–û:** –í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É–∫–∞–∂–∏ `order_130` (–Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞)

### 3. –ñ–¥–∏ 10 —Å–µ–∫—É–Ω–¥ –∏ —Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
[TON POLLING] –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏...
[TON POLLING] –ü—Ä–æ–≤–µ—Ä—è–µ–º 1 –∑–∞–∫–∞–∑–æ–≤: #130
[TON POLLING] –ù–∞–π–¥–µ–Ω–æ 10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
[TON POLLING] TX 1: 0.001000000 TON ‚Üí UQCm27jo_LGzzwx49_n... | msg: "order_130"
[TON POLLING] TX 2: 0.500000000 TON ‚Üí EQAabc123... | msg: ""
[TON POLLING] TX 3: 1.000000000 TON ‚Üí UQDxyz789... | msg: "test"
...
[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #130: –æ–∂–∏–¥–∞–µ—Ç—Å—è 0.001 TON (–º–∏–Ω: 0.000900 TON) | payload: "order_130"
‚úÖ [TON POLLING] –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê! –ó–∞–∫–∞–∑ #130 | 0.001000 TON | hash: abc123...
```

---

## üéâ –ò–¢–û–ì

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ payload (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ (–ø–µ—Ä–≤—ã–µ 20 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í–∏–¥–Ω—ã –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ª–æ–≥–∞—Ö
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ –ø–æ—á–µ–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- ‚úÖ Payload –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –∞–¥—Ä–µ—Å–æ–≤

**–ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ!** üöÄüíé

---

## üìù –í–∞–∂–Ω–æ!

**–ü—Ä–∏ –æ–ø–ª–∞—Ç–µ —á–µ—Ä–µ–∑ TON –∫–æ—à–µ–ª—ë–∫:**
1. –°–∫–æ–ø–∏—Ä—É–π deep link –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –û—Ç–∫—Ä–æ–π –≤ TON –∫–æ—à–µ–ª—å–∫–µ
3. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** —É–∫–∞–∂–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `order_130` (–Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞)
4. –û—Ç–ø—Ä–∞–≤—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
5. –ñ–¥–∏ 10 —Å–µ–∫—É–Ω–¥ ‚Äî –¥–æ–ª–∂–Ω–æ –∑–∞—Å—á–∏—Ç–∞—Ç—å—Å—è!

**–ï—Å–ª–∏ –Ω–µ –∑–∞—Å—á–∏—Ç–∞–ª–æ—Å—å:**
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ ‚Äî —Ç–∞–º –±—É–¥—É—Ç –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –£–±–µ–¥–∏—Å—å —á—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –£–±–µ–¥–∏—Å—å —á—Ç–æ —Å—É–º–º–∞ >= 0.0009 TON (90% –æ—Ç 0.001)

**–ü–†–û–í–ï–†–¨ –õ–û–ì–ò –ù–ê RAILWAY!**
