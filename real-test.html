<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ –†–µ–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π</title>
    <link rel="stylesheet" href="payment.css">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        .test-product {
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .price {
            font-size: 2rem;
            font-weight: bold;
            color: #FFD700;
            margin: 10px 0;
        }
        .crypto-price {
            font-size: 1.2rem;
            color: #90EE90;
            margin: 5px 0;
        }
        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .instructions {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .warning {
            background: rgba(255,165,0,0.2);
            border: 2px solid orange;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –†–µ–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π</h1>
        <p>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–∫—É–ø–∫—É —Å –≤–∞—à–∏–º–∏ —Ä–µ–∞–ª—å–Ω—ã–º–∏ 0.1 TON –∏ –∑–≤–µ–∑–¥–∞–º–∏!</p>
        
        <div class="warning">
            ‚ö†Ô∏è <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –≠—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ —Å –≤–∞—à–∏–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏. 
            –°—É–º–º—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        </div>

        <div class="auth-section">
            <div id="status">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...</div>
            <button onclick="refreshToken()" class="btn hidden" id="refreshBtn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
        </div>

        <!-- –¢–æ–≤–∞—Ä –∑–∞ 1 –∑–≤–µ–∑–¥—É -->
        <div class="test-product">
            <h2>‚≠ê –¢–µ—Å—Ç Stars - –ú–∏–Ω–∏-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</h2>
            <p>–ö–æ—Ä–æ—Ç–∫–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram</p>
            <div class="price">1 ‚≠ê –∑–≤–µ–∑–¥–∞</div>
            <div class="crypto-price">‚âà 1 —Ä—É–±–ª—å</div>
            <button class="btn" onclick="buyProduct(15, 'stars')">
                ‚≠ê –ö—É–ø–∏—Ç—å –∑–∞ 1 –∑–≤–µ–∑–¥—É
            </button>
        </div>

        <!-- –¢–æ–≤–∞—Ä –∑–∞ 0.01 TON -->
        <div class="test-product">
            <h2>üíé –¢–µ—Å—Ç TON - –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è 15 –º–∏–Ω</h2>
            <p>–ë—ã—Å—Ç—Ä–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
            <div class="price">0.01 TON</div>
            <div class="crypto-price">‚âà 1 —Ä—É–±–ª—å</div>
            <button class="btn" onclick="buyProduct(14, 'ton')">
                üíé –ö—É–ø–∏—Ç—å –∑–∞ 0.01 TON
            </button>
        </div>

        <div class="instructions">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:</h3>
            <h4>–î–ª—è Stars (‚≠ê):</h4>
            <ol>
                <li>–ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –∑–∞ 1 –∑–≤–µ–∑–¥—É"</li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ "Telegram Stars"</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å Stars"</li>
                <li>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ–ø–ª–∞—Ç—É –≤ Telegram</li>
                <li>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</li>
            </ol>

            <h4>–î–ª—è TON (üíé):</h4>
            <ol>
                <li>–ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –∑–∞ 0.01 TON"</li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ "–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞" ‚Üí "TON"</li>
                <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∞–¥—Ä–µ—Å –∏ memo</li>
                <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ 0.01 TON —Å –≤–∞—à–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞</li>
                <li>–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ memo –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏!</li>
                <li>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã</li>
            </ol>
        </div>

        <div class="navigation">
            <a href="/orders.html" class="nav-btn">üìã –ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
            <div id="adminNavBtn" class="nav-btn" style="display: none;" onclick="window.location.href='/admin-panel.html'">
                üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
            </div>
        </div>

        <div class="instructions">
            <h3>üîç –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã:</h3>
            <ul>
                <li>‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ "–û–ø–ª–∞—á–µ–Ω"</li>
                <li>üì± –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram</li>
                <li>üìä –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</li>
                <li>üéâ –¢–æ–≤–∞—Ä —Å—á–∏—Ç–∞–µ—Ç—Å—è "–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º"</li>
            </ul>
        </div>

        <div id="status" style="margin-top: 30px; text-align: center;"></div>
        
        <div style="margin-top: 20px; text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
            <a href="/orders.html" class="btn" style="background: #17a2b8; text-decoration: none;">
                üìã –ú–æ–∏ –∑–∞–∫–∞–∑—ã
            </a>
            <button class="btn" onclick="refreshToken()" style="background: #28a745;">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞ 401)
            </button>
        </div>
    </div>

    <script src="payment.js"></script>
    <script>
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º JWT_SECRET
        const testToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidGVsZWdyYW1faWQiOiIxMjM0NTY3ODkiLCJ1c2VybmFtZSI6InRlc3R1c2VyIiwicm9sZSI6InVzZXIiLCJpc19hZG1pbiI6MCwiaWF0IjoxNzYyMDU0NTAwLCJleHAiOjE3NjIxNDA5MDB9.J3_he9D_53acN15v8Q_CS-73FNMIVdb8AtX2iYajALU';
        localStorage.setItem('token', testToken);
        
        console.log('üîë –¢–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º JWT_SECRET —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', testToken.substring(0, 50) + '...');

        async function buyProduct(productId, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<div style="color: yellow;">üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞...</div>';

            try {
                // –°–æ–∑–¥–∞–µ–º –∑–∞–∫–∞–∑
                const response = await fetch('/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${testToken}`
                    },
                    body: JSON.stringify({
                        product_id: productId
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞');
                }

                statusDiv.innerHTML = '<div style="color: lightgreen;">‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω! –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã...</div>';

                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
                const productInfo = {
                    14: { name: '–¢–µ—Å—Ç TON - –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è 15 –º–∏–Ω', price: 1 },
                    15: { name: '–¢–µ—Å—Ç Stars - –ú–∏–Ω–∏-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è', price: 1 }
                };

                const product = productInfo[productId];

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø—Ü–∏–∏ –æ–ø–ª–∞—Ç—ã
                console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º PaymentManager –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –æ–ø—Ü–∏–π...');
                console.log('window.paymentManager:', window.paymentManager);
                
                if (window.paymentManager) {
                    console.log('‚úÖ PaymentManager –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø—Ü–∏–∏ –æ–ø–ª–∞—Ç—ã');
                    setTimeout(() => {
                        try {
                            window.paymentManager.showPaymentOptions(
                                data.id, 
                                productId, 
                                product.name, 
                                product.price
                            );
                            console.log('‚úÖ showPaymentOptions –≤—ã–∑–≤–∞–Ω');
                        } catch (error) {
                            console.error('‚ùå –û—à–∏–±–∫–∞ –≤ showPaymentOptions:', error);
                            statusDiv.innerHTML = `<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –æ–ø—Ü–∏–π: ${error.message}</div>`;
                        }
                    }, 1000);
                } else {
                    console.error('‚ùå PaymentManager –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    statusDiv.innerHTML = '<div style="color: red;">‚ùå –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.</div>';
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:', error);
                statusDiv.innerHTML = `<div style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
        async function refreshToken() {
            try {
                const response = await fetch('/api/auth/telegram', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: 123456789,
                        first_name: 'Test',
                        last_name: 'User',
                        username: 'testuser'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    localStorage.setItem('token', data.token);
                    console.log('‚úÖ –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω:', data.token.substring(0, 50) + '...');
                    document.getElementById('status').innerHTML = '<div style="color: lightgreen;">‚úÖ –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</div>';
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:', error);
                document.getElementById('status').innerHTML = `<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: ${error.message}</div>`;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤
        async function checkAdminAccess() {
            try {
                const response = await fetch('/api/user/role', {
                    headers: {
                        'Authorization': `Bearer ${testToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.role === 'admin') {
                        document.getElementById('adminNavBtn').style.display = 'block';
                        console.log('üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞');
                    }
                }
            } catch (error) {
                console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤ –Ω–µ —É–¥–∞–ª–∞—Å—å:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            autoAuthUser(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            loadProducts();
            loadUserInfo();
            checkAdminAccess();
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram WebApp
        async function autoAuthUser() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–æ–∫–µ–Ω
                const existingToken = localStorage.getItem('token');
                if (existingToken) {
                    console.log('‚úÖ –¢–æ–∫–µ–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    document.getElementById('status').innerHTML = 
                        '<div style="color: lightgreen;">‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω!</div>';
                    document.getElementById('refreshBtn').classList.remove('hidden');
                    return;
                }

                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp) {
                    const telegramUser = window.Telegram.WebApp.initDataUnsafe?.user;
                    
                    if (telegramUser && telegramUser.id) {
                        console.log('üîç –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', telegramUser);
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        const authData = {
                            id: telegramUser.id,
                            first_name: telegramUser.first_name || '',
                            last_name: telegramUser.last_name || '',
                            username: telegramUser.username || `user_${telegramUser.id}`
                        };

                        const response = await fetch('/api/auth/telegram', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(authData)
                        });

                        if (response.ok) {
                            const data = await response.json();
                            localStorage.setItem('token', data.token);
                            console.log('‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                            document.getElementById('status').innerHTML = 
                                `<div style="color: lightgreen;">‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${telegramUser.first_name}!</div>`;
                            document.getElementById('refreshBtn').classList.remove('hidden');
                        } else {
                            throw new Error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                        }
                    } else {
                        console.log('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω');
                        // Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
                        localStorage.setItem('token', testToken);
                        document.getElementById('status').innerHTML = 
                            '<div style="color: orange;">‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)</div>';
                        document.getElementById('refreshBtn').classList.remove('hidden');
                    }
                } else {
                    console.log('‚ö†Ô∏è Telegram WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω');
                    // Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
                    localStorage.setItem('token', testToken);
                    document.getElementById('status').innerHTML = 
                        '<div style="color: orange;">‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)</div>';
                    document.getElementById('refreshBtn').classList.remove('hidden');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                // Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω
                localStorage.setItem('token', testToken);
                document.getElementById('status').innerHTML = 
                    '<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º</div>';
                document.getElementById('refreshBtn').classList.remove('hidden');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º PaymentManager
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ PaymentManager...');
            if (window.paymentManager) {
                console.log('‚úÖ PaymentManager –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
            } else {
                console.error('‚ùå PaymentManager –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                // –°–æ–∑–¥–∞–µ–º PaymentManager –≤—Ä—É—á–Ω—É—é
                setTimeout(() => {
                    if (window.PaymentManager) {
                        window.paymentManager = new window.PaymentManager();
                        window.paymentManager.init();
                        console.log('‚úÖ PaymentManager —Å–æ–∑–¥–∞–Ω –≤—Ä—É—á–Ω—É—é');
                    }
                }, 1000);
            }
        });
    </script>
</body>
</html>
