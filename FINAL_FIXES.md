# ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø ‚Äî PostgreSQL

## üéØ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** SQLite —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (`db.prepare/get`) –≤–º–µ—Å—Ç–æ PostgreSQL  
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `db.query()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `$1, $2`

### 2. ‚úÖ TON Polling
**–ü—Ä–æ–±–ª–µ–º–∞:** SQLite —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (`db.prepare().all()`) –≤–º–µ—Å—Ç–æ PostgreSQL  
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `db.query()` —Å `result.rows`

---

## üìã –ò–∑–º–µ–Ω–µ–Ω–∏—è

### –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ (`/api/orders/:id`)

**–ë—ã–ª–æ (SQLite):**
```js
const getOrder = db.prepare('SELECT * FROM orders WHERE id = ? AND user_id = ?');
const order = getOrder.get(orderId, userId);
```

**–°—Ç–∞–ª–æ (PostgreSQL):**
```js
const orderResult = await db.query('SELECT id, status FROM orders WHERE id = $1 AND user_id = $2', [orderId, userId]);
const order = orderResult.rows[0];
```

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å paid)
- ‚úÖ –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

### TON Polling

**–ë—ã–ª–æ (SQLite):**
```js
const getPending = db.prepare(`SELECT ... WHERE i.status = $1 AND i.currency = $2`);
const pending = await getPending.all('pending', 'TON');

const updateInvoice = db.prepare(`UPDATE invoices SET status = $1 ...`);
await updateInvoice.run('paid', hash, inv.id);
```

**–°—Ç–∞–ª–æ (PostgreSQL):**
```js
const pendingResult = await db.query(`SELECT ... WHERE i.status = $1 AND i.currency = $2`, ['pending', 'TON']);
const pending = pendingResult.rows;

await db.query(`UPDATE invoices SET status = $1, transaction_hash = $2 ...`, ['paid', hash, inv.id]);
```

**–£–ª—É—á—à–µ–Ω–æ:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π PostgreSQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- ‚úÖ –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª 10 —Å–µ–∫—É–Ω–¥

---

## üöÄ –î–µ–ø–ª–æ–π

```bash
git add .
git commit -m "Fix delete orders and TON polling: PostgreSQL syntax"
git push
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

```bash
# –û—Ç–∫—Ä–æ–π Mini App ‚Üí "–ú–æ–∏ –∑–∞–∫–∞–∑—ã" ‚Üí "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å"
railway logs --follow | grep "ORDER DELETE"
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```
üóëÔ∏è [ORDER DELETE] –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ #94 –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1
üóëÔ∏è [ORDER DELETE] –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ #94 —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º: pending
‚úÖ [ORDER DELETE] –ó–∞–∫–∞–∑ #94 —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω
```

### 2. TON Polling

```bash
railway logs --follow | grep "TON POLLING"
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫):**
```
[TON POLLING] –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏...
[TON POLLING] –ü—Ä–æ–≤–µ—Ä—è–µ–º 1 –∑–∞–∫–∞–∑–æ–≤: #114
[TON POLLING] –ù–∞–π–¥–µ–Ω–æ 10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #114: –æ–∂–∏–¥–∞–µ—Ç—Å—è 0.001 TON (–º–∏–Ω: 0.000900 TON)
‚úÖ [TON POLLING] –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê! –ó–∞–∫–∞–∑ #114 | 0.001000 TON | hash: abc123...
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ amount —Ç–µ–ø–µ—Ä—å –Ω–µ 0:

```bash
railway logs --follow | grep "–æ–∂–∏–¥–∞–µ—Ç—Å—è"
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #114: –æ–∂–∏–¥–∞–µ—Ç—Å—è 0.001 TON  ‚Üê ‚úÖ –ù–ï 0!
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #94: –æ–∂–∏–¥–∞–µ—Ç—Å—è 0 TON  ‚Üê ‚ùå –°–¢–ê–†–´–ô –ó–ê–ö–ê–ó
```

---

## üéâ –ò–¢–û–ì

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ (PostgreSQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å)
- ‚úÖ TON Polling (PostgreSQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ amount

**–¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ Mini App
- ‚úÖ TON Polling –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—É–º–º–æ–π

---

## üö® –í–ê–ñ–ù–û

**–°—Ç–∞—Ä—ã–µ –∑–∞–∫–∞–∑—ã (#94-#113) –∏–º–µ—é—Ç amount = 0 –∏ –ù–ï –ë–£–î–£–¢ –†–ê–ë–û–¢–ê–¢–¨!**

–£–¥–∞–ª–∏ –∏—Ö:
```sql
DELETE FROM invoices WHERE amount = 0 AND currency = 'TON' AND status = 'pending';
```

**–°–æ–∑–¥–∞–π –ù–û–í–´–ô –∑–∞–∫–∞–∑ #114+ ‚Äî –æ–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!**

---

## üìù –ß–µ–∫–ª–∏—Å—Ç

- [ ] –î–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —Å amount=0
- [ ] –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ TON –∑–∞–∫–∞–∑–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ polling
- [ ] –û–ø–ª–∞—Ç–∞ 0.001 TON
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Å—á–∏—Ç—ã–≤–∞–Ω–∏—è

**–î–ï–ü–õ–û–ô –ò –ü–†–û–¢–ï–°–¢–ò–†–£–ô!** üöÄüíé
