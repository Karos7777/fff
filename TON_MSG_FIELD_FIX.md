# ‚úÖ TON MSG FIELD FIX + RANDOM PAYLOAD ‚Äî –ì–û–¢–û–í–û!

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

```
[TON POLLING] TX 1: 0.001000000 TON ‚Üí 0:a6dbb8e8... | msg: "order_131"
[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #131: payload: "order_131"
   ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- TON API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `in_msg.msg`, –∞ –Ω–µ `in_msg.message`
- –ö–æ–¥ –∏—Å–∫–∞–ª `in_msg.message` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- Payload –±—ã–ª –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º (`order_131`)

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ –≤ polling

**–ë–´–õ–û:**
```js
const txMessage = t.in_msg.decoded_body?.text || t.in_msg.message || '';
```

**–°–¢–ê–õ–û:**
```js
const txMessage = t.in_msg.msg || t.in_msg.decoded_body?.text || '';
```

**–¢–µ–ø–µ—Ä—å:**
- ‚úÖ –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `in_msg.msg` (–æ—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ)
- ‚úÖ –ó–∞—Ç–µ–º `decoded_body.text` (—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ)

### 2. –†–∞–Ω–¥–æ–º–Ω—ã–π payload (8 —Å–∏–º–≤–æ–ª–æ–≤)

**–ë–´–õ–û:**
```js
const payload = `order_${orderId}`;  // order_131
```

**–°–¢–ê–õ–û:**
```js
const payload = Math.random().toString(36).substring(2, 10).toUpperCase();  // ABC123XY
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–π (8 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ –ë—É–∫–≤—ã + —Ü–∏—Ñ—Ä—ã (A-Z, 0-9)
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å

---

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
git add .
git commit -m "Fix: use in_msg.msg field and random payload for TON"
git push
```

**–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**

### 1. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
```bash
curl -X POST http://localhost:8080/api/orders \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"product_id": 8, "payment_method": "ton"}'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "orderId": 133,
  "invoice": {
    "url": "ton://transfer/UQCm27jo...?amount=1000000&text=ABC123XY",
    "amount": "0.001000000",
    "payload": "ABC123XY"  ‚Üê –†–∞–Ω–¥–æ–º–Ω—ã–π!
  }
}
```

### 2. –û–ø–ª–∞—Ç–∏ —á–µ—Ä–µ–∑ TON –∫–æ—à–µ–ª—ë–∫

**–í–ê–ñ–ù–û:**
1. –û—Ç–∫—Ä–æ–π deep link –∏–∑ –æ—Ç–≤–µ—Ç–∞
2. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω: `ABC123XY`
3. **–ù–ï –ú–ï–ù–Ø–ô** –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!
4. –û—Ç–ø—Ä–∞–≤—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
5. –ñ–¥–∏ 8 —Å–µ–∫—É–Ω–¥

### 3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
[TON POLLING] –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏...
[TON POLLING] –ü—Ä–æ–≤–µ—Ä—è–µ–º 1 –∑–∞–∫–∞–∑–æ–≤: #133
[TON POLLING] –ù–∞–π–¥–µ–Ω–æ 20 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
[TON POLLING] TX 1: 0.001000000 TON ‚Üí 0:a6dbb8e8fcb1b3cf0c... | msg: "ABC123XY"
[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #133: payload: "ABC123XY" | —Å—É–º–º–∞ >= 0.000900000 TON
‚úÖ [TON POLLING] –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê! –ó–∞–∫–∞–∑ #133 | payload: "ABC123XY" | —Å—É–º–º–∞: 0.001000000 TON
```

**–î–û–õ–ñ–ù–û –ó–ê–°–ß–ò–¢–ê–¢–¨–°–Ø!** ‚úÖ

---

## üéâ –ò–¢–û–ì

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ `in_msg.msg`
- ‚úÖ –†–∞–Ω–¥–æ–º–Ω—ã–π payload –∏–∑ 8 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π payload

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Polling –Ω–∞—Ö–æ–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ Payload —É–Ω–∏–∫–∞–ª–µ–Ω –∏ –±–µ–∑–æ–ø–∞—Å–µ–Ω
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (8 —Å–µ–∫—É–Ω–¥)

**–ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ!** üöÄüíé

---

## üìù –í–∞–∂–Ω–æ!

**–ü—Ä–∏ –æ–ø–ª–∞—Ç–µ:**
1. –ò—Å–ø–æ–ª—å–∑—É–π deep link –∏–∑ –æ—Ç–≤–µ—Ç–∞ API
2. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **–ù–ï –ú–ï–ù–Ø–ô** –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π ‚Äî –æ–Ω —É–Ω–∏–∫–∞–ª–µ–Ω!
4. –û—Ç–ø—Ä–∞–≤—å >= 0.0009 TON
5. –ñ–¥–∏ 8 —Å–µ–∫—É–Ω–¥ ‚Äî –¥–æ–ª–∂–Ω–æ –∑–∞—Å—á–∏—Ç–∞—Ç—å—Å—è!

**–ï—Å–ª–∏ –Ω–µ –∑–∞—Å—á–∏—Ç–∞–ª–æ—Å—å:**
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ ‚Äî —Ç–∞–º –±—É–¥—É—Ç –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å msg
- –£–±–µ–¥–∏—Å—å —á—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
- –£–±–µ–¥–∏—Å—å —á—Ç–æ —Å—É–º–º–∞ >= 0.0009 TON

**–ü–†–û–í–ï–†–¨ –õ–û–ì–ò –ù–ê RAILWAY ‚Äî –î–û–õ–ñ–ù–û –†–ê–ë–û–¢–ê–¢–¨!**

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**TON API —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "transactions": [
    {
      "in_msg": {
        "msg": "ABC123XY",           ‚Üê –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ
        "decoded_body": {
          "text": "ABC123XY"         ‚Üê –†–µ–∑–µ—Ä–≤–Ω–æ–µ
        },
        "value": "1000000",
        "destination": {
          "address": "UQCm27jo..."
        }
      }
    }
  ]
}
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è payload:**
```js
Math.random().toString(36).substring(2, 10).toUpperCase()
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "ABC123XY" (8 —Å–∏–º–≤–æ–ª–æ–≤, A-Z, 0-9)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ polling:**
1. `in_msg.msg === payload` ‚úÖ
2. `destination === address` ‚úÖ
3. `amount >= minAmount` ‚úÖ

**–í—Å–µ 3 —É—Å–ª–æ–≤–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å TRUE!**
