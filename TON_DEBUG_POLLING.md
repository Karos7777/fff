# üîç TON POLLING ‚Äî –†–ï–ñ–ò–ú –û–¢–õ–ê–î–ö–ò

## üéØ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

**–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã.

---

## üìã –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ò–Ω—Ç–µ—Ä–≤–∞–ª: 10 —Å–µ–∫—É–Ω–¥ (–≤–º–µ—Å—Ç–æ 20)
```js
}, 10000); // –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
```

### 2. –í—ã–≤–æ–¥ –í–°–ï–• —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```js
console.log(`[TON POLLING] –ù–∞–π–¥–µ–Ω–æ ${data.result.length} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ`);

for (const tx of data.result) {
  console.log(`[TON TX] ${(value / 1e9).toFixed(6)} TON | –æ—Ç: ${source}... ‚Üí ${dest}...`);
}
```

### 3. –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –∏–Ω–≤–æ–π—Å—É
```js
console.log(`[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #${inv.order_id}: –æ–∂–∏–¥–∞–µ—Ç—Å—è ${expectedNano} nanoTON (–º–∏–Ω: ${minAcceptable})`);

if (tx) {
  console.log('[TON POLLING] ‚úÖ –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê!', { ... });
} else {
  console.log(`[TON POLLING] ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è –∑–∞–∫–∞–∑–∞ #${inv.order_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
}
```

### 4. –î–æ–ø—É—Å–∫ —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 10%
```js
const minAcceptable = Math.round(expectedNano * 0.9); // 90%
```

---

## üöÄ –î–µ–ø–ª–æ–π

```bash
git add .
git commit -m "Add debug logging for TON polling"
git push
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
```
üíé –ó–∞–ø—É—Å–∫ TON polling –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
```

### –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ (–µ—Å–ª–∏ –µ—Å—Ç—å pending –∑–∞–∫–∞–∑—ã):
```
[TON POLLING] –ü—Ä–æ–≤–µ—Ä–∫–∞ 1 –æ–∂–∏–¥–∞—é—â–∏—Ö –∏–Ω–≤–æ–π—Å–æ–≤...
[TON POLLING] –ù–∞–π–¥–µ–Ω–æ 5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ
[TON TX] 0.001000 TON | –æ—Ç: EQAbc123... ‚Üí UQCm27jo... | hash: abc123...
[TON TX] 0.050000 TON | –æ—Ç: EQDef456... ‚Üí UQCm27jo... | hash: def456...
[TON TX] 0.000500 TON | –æ—Ç: EQGhi789... ‚Üí UQCm27jo... | hash: ghi789...
[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #107: –æ–∂–∏–¥–∞–µ—Ç—Å—è 1000000 nanoTON (–º–∏–Ω: 900000)
[TON POLLING] ‚úÖ –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê! {
  orderId: 107,
  receivedNano: 1000000,
  receivedTON: '0.001000',
  expectedNano: 1000000,
  difference: '0.00%'
}
```

### –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:
```
[TON POLLING] –ü—Ä–æ–≤–µ—Ä–∫–∞ 1 –æ–∂–∏–¥–∞—é—â–∏—Ö –∏–Ω–≤–æ–π—Å–æ–≤...
[TON POLLING] –ù–∞–π–¥–µ–Ω–æ 3 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ
[TON TX] 0.050000 TON | –æ—Ç: EQAbc... ‚Üí UQCm27jo... | hash: abc...
[TON TX] 0.100000 TON | –æ—Ç: EQDef... ‚Üí UQCm27jo... | hash: def...
[TON POLLING] –ò—â–µ–º –¥–ª—è –∑–∞–∫–∞–∑–∞ #108: –æ–∂–∏–¥–∞–µ—Ç—Å—è 1000000 nanoTON (–º–∏–Ω: 900000)
[TON POLLING] ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è –∑–∞–∫–∞–∑–∞ #108 –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
```bash
railway logs --follow | grep "TON"
```

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å:

#### 1. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∏–¥–Ω—ã?**
```
[TON POLLING] –ù–∞–π–¥–µ–Ω–æ 5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ
[TON TX] 0.001000 TON | ...
```
‚úÖ –ï—Å–ª–∏ –≤–∏–¥–Ω—ã ‚Üí TON Center —Ä–∞–±–æ—Ç–∞–µ—Ç

#### 2. **–°—É–º–º–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç?**
```
[TON TX] 0.001000 TON | ...
[TON POLLING] –ò—â–µ–º: –æ–∂–∏–¥–∞–µ—Ç—Å—è 1000000 nanoTON (–º–∏–Ω: 900000)
```
‚úÖ 0.001 TON = 1,000,000 nanoTON ‚Üí –¥–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏

#### 3. **–ê–¥—Ä–µ—Å —Å–æ–≤–ø–∞–¥–∞–µ—Ç?**
```
[TON TX] ... ‚Üí UQCm27jo... | ...
```
‚úÖ –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `destination` = —Ç–≤–æ–π `TON_WALLET_ADDRESS`

#### 4. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞?**
```
[TON POLLING] ‚úÖ –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê!
```
–∏–ª–∏
```
[TON POLLING] ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ—Ç –≤ –ª–æ–≥–∞—Ö
```
[TON POLLING] –ù–∞–π–¥–µ–Ω–æ 0 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ
```
**–ü—Ä–∏—á–∏–Ω–∞:** TON Center –Ω–µ –≤–∏–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∑–∞–¥–µ—Ä–∂–∫–∞ –±–ª–æ–∫—á–µ–π–Ω–∞)
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥–æ–∂–¥–∏ 1-2 –º–∏–Ω—É—Ç—ã

### 2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –µ—Å—Ç—å, –Ω–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è
```
[TON TX] 0.001000 TON | –æ—Ç: EQAbc... ‚Üí UQCm27jo...
[TON POLLING] ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```
**–ü—Ä–∏—á–∏–Ω–∞:** `destination` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `TON_WALLET_ADDRESS`
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 3. –°—É–º–º–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
```
[TON TX] 0.000950 TON | ...
[TON POLLING] –ò—â–µ–º: –º–∏–Ω: 900000 (0.0009 TON)
```
**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–º–∏—Å—Å–∏—è > 10%
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á—å –¥–æ–ø—É—Å–∫ –¥–æ 15%:
```js
const minAcceptable = Math.round(expectedNano * 0.85);
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª polling:
```js
}, 10000); // 10 —Å–µ–∫
}, 5000);  // 5 —Å–µ–∫
}, 15000); // 15 —Å–µ–∫
```

### –ò–∑–º–µ–Ω–∏—Ç—å –¥–æ–ø—É—Å–∫ –∫–æ–º–∏—Å—Å–∏–∏:
```js
const minAcceptable = Math.round(expectedNano * 0.9);  // 10%
const minAcceptable = Math.round(expectedNano * 0.85); // 15%
const minAcceptable = Math.round(expectedNano * 0.95); // 5%
```

### –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
```js
const url = `...&limit=10`; // 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
const url = `...&limit=20`; // 20 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
const url = `...&limit=5`;  // 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
```

---

## üéâ –ò–¢–û–ì

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –í—ã–≤–æ–¥ –æ–∂–∏–¥–∞–µ–º–æ–π —Å—É–º–º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª 10 —Å–µ–∫ (–±—ã—Å—Ç—Ä–µ–µ)
- ‚úÖ –î–æ–ø—É—Å–∫ 10% (–±–æ–ª—å—à–µ)

**–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ:**
- üîç –£–≤–∏–¥–µ—Ç—å –í–°–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ
- üîç –ü–æ–Ω—è—Ç—å –ø–æ—á–µ–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è
- üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∑–∞ 1 –º–∏–Ω—É—Ç—É

**–î–ï–ü–õ–û–ô –ò –°–ú–û–¢–†–ò –õ–û–ì–ò!** üöÄüîç
