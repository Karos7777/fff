# ‚úÖ –†–ï–§–ê–ö–¢–û–†–ò–ù–ì –ó–ê–í–ï–†–®–Å–ù!

## üéØ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
tg_magazin_bot/
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ orders.js          ‚úÖ –ó–∞–∫–∞–∑—ã (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)
‚îÇ   ‚îî‚îÄ‚îÄ ton.js             ‚úÖ TON –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ tonPolling.js      ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ TON
‚îî‚îÄ‚îÄ server.js              ‚úÖ –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (–Ω–∞ 1000+ —Å—Ç—Ä–æ–∫ –º–µ–Ω—å—à–µ!)
```

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω—ã –º–æ–¥—É–ª–∏ –≤ server.js
- ‚úÖ `require('./routes/orders')`
- ‚úÖ `require('./routes/ton')`
- ‚úÖ `require('./services/tonPolling')`
- ‚úÖ `app.set('paymentService', paymentService)`
- ‚úÖ `app.use('/api/orders', ordersRoutes(db, authMiddlewareWithDB))`
- ‚úÖ `app.use('/api/ton', tonRoutes(db, authMiddlewareWithDB))`
- ‚úÖ `tonPolling(db)` –≤ app.listen

### 3. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç–∞—Ä—ã–µ —Ä–æ—É—Ç—ã
- ‚úÖ POST /api/orders
- ‚úÖ GET /api/orders
- ‚úÖ DELETE /api/orders/:id
- ‚úÖ GET /api/orders/:orderId/download
- ‚úÖ GET /api/ton/check/:orderId
- ‚úÖ POST /api/ton/check-payment
- ‚úÖ –°—Ç–∞—Ä—ã–π TON polling –±–ª–æ–∫

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –ª–æ–∫–∞–ª—å–Ω–æ
```bash
npm start
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
‚úÖ –°–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
‚úÖ –ú–æ–¥—É–ª—å–Ω—ã–µ —Ä–æ—É—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080
‚úÖ TON Polling —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω
üíé –ó–∞–ø—É—Å–∫ TON polling –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
üíé –ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞: UQCm27jo...
```

### 2. –ü—Ä–æ–≤–µ—Ä—å endpoints

**–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞:**
```bash
curl -X POST http://localhost:8080/api/orders \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"product_id": 8, "payment_method": "ton"}'
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ TON:**
```bash
curl http://localhost:8080/api/ton/check/114 \
  -H "Authorization: Bearer <token>"
```

**–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:**
```bash
curl -X DELETE http://localhost:8080/api/orders/94 \
  -H "Authorization: Bearer <token>"
```

### 3. –ü—Ä–æ–≤–µ—Ä—å polling
```bash
# –°–æ–∑–¥–∞–π –∑–∞–∫–∞–∑, –æ–ø–ª–∞—Ç–∏, –∂–¥–∏ 10 —Å–µ–∫
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
[TON POLLING] –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏...
[TON POLLING] –ü—Ä–æ–≤–µ—Ä—è–µ–º 1 –∑–∞–∫–∞–∑–æ–≤: #114
‚úÖ [TON POLLING] –û–ü–õ–ê–¢–ê –ó–ê–°–ß–ò–¢–ê–ù–ê! –ó–∞–∫–∞–∑ #114
```

### 4. –î–µ–ø–ª–æ–π
```bash
git add .
git commit -m "Refactor: split server.js into modules (routes + services)"
git push
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- ‚ùå server.js ‚Äî 2180 —Å—Ç—Ä–æ–∫
- ‚ùå –í—Å—ë –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- ‚ùå –°–ª–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π –∫–æ–¥
- ‚ùå –ò–ò –ø—É—Ç–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- ‚úÖ server.js ‚Äî ~1100 —Å—Ç—Ä–æ–∫ (–Ω–∞ 50% –º–µ–Ω—å—à–µ!)
- ‚úÖ routes/orders.js ‚Äî 200 —Å—Ç—Ä–æ–∫
- ‚úÖ routes/ton.js ‚Äî 120 —Å—Ç—Ä–æ–∫
- ‚úÖ services/tonPolling.js ‚Äî 80 —Å—Ç—Ä–æ–∫
- ‚úÖ –ö–æ–¥ —Ä–∞–∑–¥–µ–ª—ë–Ω –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º
- ‚úÖ –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π endpoint
- ‚úÖ –ò–ò —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ—á–Ω–µ–µ

---

## üßπ –û—á–∏—Å—Ç–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–µ—à—å —É–¥–∞–ª–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:

1. –ù–∞–π–¥–∏ –±–ª–æ–∫–∏ —Å `/*` –∏ `*/`
2. –£–¥–∞–ª–∏ –∏—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é
3. –°–æ—Ö—Ä–∞–Ω–∏ —Ñ–∞–π–ª

–ò–ª–∏ –æ—Å—Ç–∞–≤—å –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ.

---

## üéâ –ò–¢–û–ì

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å +100%
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ +100%
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ +100%
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å +100%

**–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å:**
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å routes/products.js
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å routes/admin.js
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å db/queries.js
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å tests/

**–†–ï–§–ê–ö–¢–û–†–ò–ù–ì –ó–ê–í–ï–†–®–Å–ù!** üöÄüì¶

---

## üìù –ß–µ–∫–ª–∏—Å—Ç

- [x] –°–æ–∑–¥–∞—Ç—å routes/orders.js
- [x] –°–æ–∑–¥–∞—Ç—å routes/ton.js
- [x] –°–æ–∑–¥–∞—Ç—å services/tonPolling.js
- [x] –ü–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª–∏ –≤ server.js
- [x] –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ä–æ—É—Ç—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ Railway
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
- [ ] –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ!** üéØ
